{% extends "immobilier/base.html" %}
{% block page_theme %}theme-contrats{% endblock %}

{% block title %}{{ title }} - Gestion Immobilière{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<p>Choisissez d'abord un propriétaire pour filtrer automatiquement ses biens disponibles.</p>

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Enregistrer</button>
    <a href="{% url 'contrats_liste' %}">Annuler</a>
</form>

<script>
    (function () {
        const ownerSelect = document.getElementById('id_proprietaire');
        if (!ownerSelect) return;

        ownerSelect.addEventListener('change', function () {
            const ownerId = ownerSelect.value;
            const url = new URL(window.location.href);

            if (ownerId) {
                url.searchParams.set('proprietaire', ownerId);
            } else {
                url.searchParams.delete('proprietaire');
            }

            window.location.href = url.pathname + url.search;
        });
    })();
</script>
{% endblock %}
